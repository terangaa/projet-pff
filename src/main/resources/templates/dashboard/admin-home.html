<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Dashboard Agricole ðŸŒ¿ - PAGAM</title>

    <!-- Bootstrap & Remix icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.7.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        :root{
            --bg-overlay-1: rgba(6,32,8,0.62);
            --glass: rgba(255,255,255,0.06);
            --glass-strong: rgba(255,255,255,0.12);
            --accent-600: #2e7d32;
            --accent-500: #43a047;
            --accent-300: #a5d6a7;
        }

        html,body{height:100%; margin:0; font-family:"Poppins", "Segoe UI", system-ui, -apple-system, Roboto, Arial, sans-serif;}

        /* Page background like PAGAM (high quality image + overlay) */
        body{
            background: url('https://images.unsplash.com/photo-1501004318641-b39e6451bec6?q=80&w=1600&auto=format&fit=crop&ixlib=rb-4.0.3&s=') center/cover fixed no-repeat;
            color: #0b3b14;
            position: relative;
            -webkit-font-smoothing:antialiased;
        }
        /* dark green overlay for contrast */
        body::before{
            content:"";
            position:fixed;
            inset:0;
            background: linear-gradient(180deg, rgba(11,53,12,0.55), rgba(6,32,8,0.68));
            z-index:0;
            backdrop-filter: blur(2px);
        }

        /* Sidebar - glass look */
        .sidebar {
            position: fixed;
            top: 20px;
            left: 20px;
            bottom: 20px;
            width: 260px;
            padding: 22px;
            z-index: 20;
            border-radius: 18px;
            background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
            border: 1px solid rgba(255,255,255,0.06);
            box-shadow: 0 20px 40px rgba(6,32,8,0.6);
            color: #e9f7ef;
            display:flex;
            flex-direction:column;
            gap:12px;
            transition: width .28s ease, transform .28s ease;
        }
        .sidebar.collapsed { width:86px; }
        .sidebar h3{ margin:0; font-size:1.2rem; font-weight:700; color:#eaf7ea; display:flex; gap:10px; align-items:center; }
        .sidebar nav{ display:flex; flex-direction:column; gap:6px; margin-top:8px; }
        .sidebar a {
            display:flex; align-items:center; gap:12px; padding:10px 12px; border-radius:12px; text-decoration:none; color:rgba(255,255,255,0.92);
            transition: background .25s, transform .2s;
            font-weight:600;
        }
        .sidebar a:hover, .sidebar a.active { background: rgba(255,255,255,0.06); transform: translateX(6px); }
        .sidebar i { font-size:1.25rem; color: #fff; }

        .sidebar .logout {
            margin-top:auto;
            padding-top:8px;
        }
        .sidebar .logout a { color:#ffd; font-weight:700; }

        /* Main container */
        .main {
            margin-left: 300px;
            padding: 34px;
            transition: margin-left .28s ease;
            position:relative;
            z-index:5;
        }
        .main.collapsed { margin-left:120px; }

        /* Topbar */
        .topbar {
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:12px;
            margin-bottom:20px;
        }
        .menu-toggle {
            background: linear-gradient(90deg,var(--accent-600),var(--accent-500));
            border: none; color: white; padding:10px 12px; border-radius:12px; cursor:pointer; box-shadow:0 8px 20px rgba(0,0,0,0.25);
            display:flex; gap:8px; align-items:center; font-weight:700;
        }
        .topbar .title { font-size:1.2rem; font-weight:700; color:#f1fff1; text-shadow: 0 6px 18px rgba(0,0,0,0.35); }

        /* Hero */
        .hero {
            border-radius:18px;
            padding:28px;
            background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
            border: 1px solid rgba(255,255,255,0.04);
            box-shadow: 0 20px 40px rgba(6,32,8,0.45);
            color:#f7fff7;
            overflow:hidden;
            position:relative;
        }
        .hero .overlay {
            position:absolute; inset:0; pointer-events:none;
            background: linear-gradient(90deg, rgba(34,139,34,0.12), rgba(46,125,50,0.06));
            mix-blend-mode: overlay;
        }
        .hero h1 { margin:0; font-size:clamp(1.4rem,2.6vw,2.2rem); letter-spacing:.6px; font-weight:800; color:#e8ffef; }
        .hero p { margin-top:8px; color: #e9f7ef; opacity:0.95; }

        /* KPI grid */
        .kpis { margin-top:22px; display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:18px; }
        .kpi-card {
            border-radius:14px; padding:18px; position:relative; overflow:hidden;
            background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
            border:1px solid rgba(255,255,255,0.04);
            box-shadow: 0 14px 30px rgba(6,32,8,0.35);
            color:#fff;
            transition: transform .28s ease, box-shadow .28s ease;
        }
        .kpi-card:hover { transform: translateY(-8px); box-shadow: 0 28px 46px rgba(6,32,8,0.5); }
        .kpi-icon { font-size:2.2rem; background: linear-gradient(135deg,var(--accent-500),var(--accent-300)); width:64px; height:64px; display:flex; align-items:center; justify-content:center; border-radius:12px; color:#072b10; box-shadow: 0 10px 22px rgba(0,0,0,0.22);}
        .kpi-title { font-weight:700; margin-top:8px; font-size:1rem; color:#e9fff0; }
        .kpi-desc { font-size:.92rem; color:rgba(255,255,255,0.85); margin-top:6px; }
        .kpi-badge { position:absolute; top:12px; right:12px; background: rgba(255,255,255,0.95); color: var(--accent-600); font-weight:800; padding:6px 10px; border-radius:12px; }

        /* Specific color styles for differentiation (kept readable) */
        .card-user .kpi-icon { background: linear-gradient(135deg,#81c784,#2e7d32); }
        .card-sensor .kpi-icon { background: linear-gradient(135deg,#00c9ff,#92fe9d); color:#013; }
        .card-product .kpi-icon { background: linear-gradient(135deg,#ffd54f,#ffb74d); color:#2b2b2b; }
        .card-order .kpi-icon { background: linear-gradient(135deg,#fb7185,#f97316); color:#fff; }
        .card-alert .kpi-icon { background: linear-gradient(135deg,#90caf9,#c2e9fb); color:#063449; }
        .card-sale .kpi-icon { background: linear-gradient(135deg,#11998e,#38ef7d); color:#042; }
        .card-weather .kpi-icon { background: linear-gradient(135deg,#00b4db,#0083b0); color:#fff; }

        /* Footer */
        footer {
            margin-top:36px;
            padding:18px;
            border-radius:12px;
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border:1px solid rgba(255,255,255,0.03);
            color: #eaf7ea;
            text-align:center;
            box-shadow: 0 12px 30px rgba(6,32,8,0.32);
        }

        /* Responsive behavior */
        @media (max-width: 992px){
            .sidebar { position:fixed; left:12px; top:12px; width:220px; bottom:12px; }
            .main { margin-left:260px; padding:18px; }
        }
        @media (max-width:768px){
            .sidebar { left:8px; top:8px; bottom:8px; width:86px; padding:12px; border-radius:12px; }
            .sidebar h3, .sidebar nav a span { display:none; }
            .main { margin-left:110px; padding:14px; }
            .hero { padding:18px; }
            .kpis { grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:12px; }
        }

    </style>
</head>
<body>

<!-- Sidebar (functionality preserved) -->
<aside class="sidebar" id="sidebar">
    <h3><i class="ri-seedling-line"></i> <span>PAGAM</span></h3>

    <nav>
        <a href="/utilisateurs" class="active"><i class="ri-user-settings-line"></i><span>Utilisateurs</span></a>
        <a href="/capteurs"><i class="ri-windy-line"></i><span>Capteurs</span></a>
        <a href="/produits"><i class="ri-seedling-line"></i><span>Produits</span></a>
        <a href="/commandes"><i class="ri-truck-line"></i><span>Commandes</span></a>
        <a href="/alertes"><i class="ri-alert-line"></i><span>Alertes</span></a>
        <a href="/agriculteur/ventes"><i class="ri-store-2-line"></i><span>Ventes</span></a>
        <a href="/meteo"><i class="ri-sun-cloudy-line"></i><span>MÃ©tÃ©o</span></a>
    </nav>

    <div class="logout">
        <a href="/auth/logout"><i class="ri-logout-box-line"></i><span>DÃ©connexion</span></a>
    </div>
</aside>

<!-- Main content -->
<section class="main" id="main">
    <div class="topbar">
        <button id="menuToggle" class="menu-toggle"><i class="ri-menu-3-line"></i> <span style="margin-left:6px">Menu</span></button>
        <div class="d-flex align-items-center gap-3">
            <div class="title">Tableau de bord Agricole</div>
            <!-- Quick small controls could go here -->
        </div>
    </div>

    <!-- Hero -->
    <div class="hero">
        <div class="overlay" aria-hidden="true"></div>
        <div class="d-flex align-items-center justify-content-between gap-3 flex-wrap">
            <div>
                <h1>Bienvenue, Administrateur ðŸŒ»</h1>
                <p class="mb-0">GÃ©rez fermes, capteurs, produits et ventes avec une interface moderne et sÃ©curisÃ©e.</p>
            </div>

            <div class="text-end">
                <div class="small text-light">Capteurs actifs</div>
                <div class="h4 fw-bold" style="color:#fff">24</div>
            </div>
        </div>

        <!-- KPI grid -->
        <div class="kpis">
            <a href="/utilisateurs" class="text-decoration-none">
                <div class="kpi-card card-user">
                    <div class="d-flex gap-3 align-items-center">
                        <div class="kpi-icon"><i class="ri-user-settings-line"></i></div>
                        <div>
                            <div class="kpi-title">Utilisateurs</div>
                            <div class="kpi-desc">Gestion des membres</div>
                        </div>
                    </div>
                    <div class="kpi-badge" th:text="${nbUtilisateurs}">0</div>
                </div>
            </a>

            <a href="/capteurs" class="text-decoration-none">
                <div class="kpi-card card-sensor">
                    <div class="d-flex gap-3 align-items-center">
                        <div class="kpi-icon"><i class="ri-windy-line"></i></div>
                        <div>
                            <div class="kpi-title">Capteurs</div>
                            <div class="kpi-desc">Surveillance climatique</div>
                        </div>
                    </div>
                    <div class="kpi-badge" th:text="${nbCapteurs}">0</div>
                </div>
            </a>

            <a href="/produits" class="text-decoration-none">
                <div class="kpi-card card-product">
                    <div class="d-flex gap-3 align-items-center">
                        <div class="kpi-icon"><i class="ri-seedling-line"></i></div>
                        <div>
                            <div class="kpi-title">Produits</div>
                            <div class="kpi-desc">Suivi des cultures</div>
                        </div>
                    </div>
                    <div class="kpi-badge" th:text="${nbProduits}">0</div>
                </div>
            </a>

            <a href="/commandes" class="text-decoration-none">
                <div class="kpi-card card-order">
                    <div class="d-flex gap-3 align-items-center">
                        <div class="kpi-icon"><i class="ri-truck-line"></i></div>
                        <div>
                            <div class="kpi-title">Commandes</div>
                            <div class="kpi-desc">Livraisons & clients</div>
                        </div>
                    </div>
                    <div class="kpi-badge" th:text="${nbCommandes}">0</div>
                </div>
            </a>

            <a href="/alertes" class="text-decoration-none">
                <div class="kpi-card card-alert">
                    <div class="d-flex gap-3 align-items-center">
                        <div class="kpi-icon"><i class="ri-alert-line"></i></div>
                        <div>
                            <div class="kpi-title">Alertes</div>
                            <div class="kpi-desc">Surveillance des anomalies</div>
                        </div>
                    </div>
                    <div class="kpi-badge" th:text="${nbAlertes}">0</div>
                </div>
            </a>

            <a href="/agriculteur/ventes" class="text-decoration-none">
                <div class="kpi-card card-sale">
                    <div class="d-flex gap-3 align-items-center">
                        <div class="kpi-icon"><i class="ri-store-2-line"></i></div>
                        <div>
                            <div class="kpi-title">Ventes</div>
                            <div class="kpi-desc">Suivi des revenus</div>
                        </div>
                    </div>
                    <div class="kpi-badge" th:text="${nbVentes}">0</div>
                </div>
            </a>

            <a href="/meteo" class="text-decoration-none">
                <div class="kpi-card card-weather">
                    <div class="d-flex gap-3 align-items-center">
                        <div class="kpi-icon" id="weatherIcon"><i class="ri-sun-cloudy-line"></i></div>
                        <div>
                            <div class="kpi-title">MÃ©tÃ©o</div>
                            <div class="kpi-desc">TempÃ©rature Ã  <span id="city">Dakar</span></div>
                        </div>
                    </div>
                    <div class="kpi-badge" id="temperature">--Â°C</div>
                </div>
            </a>
        </div>
    </div>

    <footer>
        <p>Â© 2025 - Tableau Agricole Intelligent â€¢ PAGAM</p>
    </footer>
</section>

<!-- Keep original script & functionality intact (only cosmetic change) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Sidebar collapse toggle (preserves original behavior)
    const sidebar = document.getElementById("sidebar");
    const main = document.getElementById("main");
    const menuToggle = document.getElementById("menuToggle");

    menuToggle.addEventListener("click", () => {
        // On wide screens collapse/expand; on small screens toggle visible sidebar
        if (window.innerWidth > 768) {
            sidebar.classList.toggle("collapsed");
            main.classList.toggle("collapsed");
        } else {
            sidebar.classList.toggle("active");
        }
    });

    // MÃ©tÃ©o API (fonctionnalitÃ© inchangÃ©e)
    const apiKey = "91a421e86c57cd1309cb65e78e8d673a";
    const cityName = "Dakar";
    const temperatureEl = document.getElementById("temperature");
    const cityEl = document.getElementById("city");
    const weatherIconEl = document.getElementById("weatherIcon");

    async function updateDashboardWeather() {
        try {
            const res = await fetch(https://api.openweathermap.org/data/2.5/weather?q=${cityName}&units=metric&lang=fr&appid=${apiKey});
            const data = await res.json();
            temperatureEl.innerText = Math.round(data.main.temp) + "Â°C";
            cityEl.innerText = data.name || cityName;

            // Optional: update icon (simple mapping, keeps original element)
            const weatherId = data.weather && data.weather[0] && data.weather[0].id;
            if (weatherId) {
                // clear existing icon
                weatherIconEl.innerHTML = '';
                if (weatherId >= 200 && weatherId < 600) {
                    weatherIconEl.innerHTML = '<i class=\"ri-cloud-lightning-line\"></i>';
                } else if (weatherId >= 600 && weatherId < 700) {
                    weatherIconEl.innerHTML = '<i class=\"ri-snowy-line\"></i>';
                } else if (weatherId >= 700 && weatherId < 800) {
                    weatherIconEl.innerHTML = '<i class=\"ri-foggy-line\"></i>';
                } else if (weatherId === 800) {
                    weatherIconEl.innerHTML = '<i class=\"ri-sun-line\"></i>';
                } else {
                    weatherIconEl.innerHTML = '<i class=\"ri-cloudy-line\"></i>';
                }
            }
        } catch (error) {
            temperatureEl.innerText = "--Â°C";
            cityEl.innerText = cityName;
        }
    }

    updateDashboardWeather();
    // refresh every 10 minutes (same as before)
    setInterval(updateDashboardWeather, 600000);
</script>
</body>
</html>