<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; transition: background 0.3s, color 0.3s; }

        /* Sidebar */
        .sidebar { height: 100vh; width: 250px; position: fixed; top: 0; left: 0; background: linear-gradient(135deg, #2ecc71, #27ae60); color: white; padding-top: 20px; transition: all 0.3s; overflow-y: auto; z-index: 1000; }
        .sidebar h3 { text-align: center; font-weight: bold; margin-bottom: 30px; }
        .sidebar a { display: block; color: white; padding: 12px 20px; text-decoration: none; transition: background 0.3s; }
        .sidebar a:hover, .sidebar a.active { background: rgba(255,255,255,0.2); border-radius: 8px; }
        .sidebar .logout { position: absolute; bottom: 20px; width: 100%; }

        /* Sidebar fermée */
        .sidebar.collapsed { width: 70px; }
        .sidebar.collapsed h3, .sidebar.collapsed .logout { display: none; }
        .sidebar.collapsed a { text-align: center; padding: 12px 0; }
        .sidebar.collapsed a i { font-size: 1.4rem; }

        /* Content */
        .content { margin-left: 260px; padding: 20px; transition: margin-left 0.3s; }
        .content.collapsed { margin-left: 80px; }

        /* Navbar / Bouton menu */
        .topbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .menu-toggle { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #27ae60; }

        /* Hero Section */
        .hero { background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; padding: 50px 20px; border-radius: 15px; text-align: center; margin-bottom: 40px; }

        /* KPI Cards */
        .kpi-card { height: 180px; border-radius: 20px; text-align: center; display: flex; flex-direction: column; justify-content: center; transition: transform 0.4s, box-shadow 0.4s; cursor: pointer; }
        .kpi-card:hover { transform: translateY(-10px) scale(1.05); box-shadow: 0 25px 40px rgba(0,0,0,0.25); }
        .kpi-icon { font-size: 3rem; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        .badge-kpi { position: absolute; top: 10px; right: 10px; font-size: 1rem; padding: 0.5rem 0.8rem; border-radius: 12px; background-color: #fff; font-weight: bold; animation: pulse 1.5s infinite; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }

        /* Déclinaisons de couleurs */
        .card-gradient-primary { background: linear-gradient(135deg, #6dd5ed, #2193b0); color: #fff; }
        .card-gradient-success { background: linear-gradient(135deg, #56ab2f, #a8e063); color: #fff; }
        .card-gradient-warning { background: linear-gradient(135deg, #fddb92, #d1fdff); color: #333; }
        .card-gradient-danger { background: linear-gradient(135deg, #f857a6, #ff5858); color: #fff; }
        .card-gradient-secondary { background: linear-gradient(135deg, #cfd9df, #e2ebf0); color: #333; }
        .card-gradient-weather { background: linear-gradient(135deg, #FFD200, #FF7300); color: #fff; }

        .kpi-description { font-size: 0.9rem; margin-top: 5px; opacity: 0.85; }

        /* Footer */
        footer { background-color: #27ae60; color: white; text-align: center; padding: 15px; margin-top: 40px; border-radius: 12px; }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { position: absolute; z-index: 1050; height: 100%; left: -260px; }
            .sidebar.active { left: 0; }
            .content { margin-left: 0; }
            .content.collapsed { margin-left: 0; }
        }
    </style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
    <h3>🌱 Admin</h3>
    <a href="/utilisateurs"><i class="bi bi-people"></i> <span class="ms-2">Utilisateurs</span></a>
    <a href="/capteurs"><i class="bi bi-satellite"></i> <span class="ms-2">Capteurs</span></a>
    <a href="/produits"><i class="bi bi-box-seam"></i> <span class="ms-2">Produits</span></a>
    <a href="/commandes"><i class="bi bi-cart"></i> <span class="ms-2">Commandes</span></a>
    <a href="/alertes"><i class="bi bi-exclamation-triangle"></i> <span class="ms-2">Alertes</span></a>
    <a href="/agriculteur/ventes"><i class="bi bi-cart3"></i> <span class="ms-2">Ventes</span></a>
    <div class="logout">
        <a href="/auth/logout" class="text-danger"><i class="bi bi-box-arrow-right"></i> Déconnexion</a>
    </div>
</div>

<!-- Contenu principal -->
<div class="content" id="content">
    <!-- Topbar -->
    <div class="topbar">
        <button class="menu-toggle" id="menuToggle"><i class="bi bi-list"></i></button>
        <h4 class="fw-bold mb-0">Tableau de Bord</h4>
    </div>

    <!-- Hero Section -->
    <div class="hero">
        <h1 class="fw-bold">Bienvenue, Administrateur 👋</h1>
        <p class="lead">🌾 Gérez vos utilisateurs, capteurs, ventes et plus encore depuis ce tableau de bord.</p>
    </div>

    <!-- KPI Cards -->
    <div class="row g-4">

        <!-- Utilisateurs -->
        <div class="col-12 col-md-6 col-lg-4">
            <a href="/utilisateurs" class="text-decoration-none">
                <div class="card kpi-card card-gradient-primary shadow-sm position-relative">
                    <div class="card-body">
                        <i class="bi bi-people kpi-icon mb-2"></i>
                        <h5>Utilisateurs</h5>
                        <p class="kpi-description">Voir et gérer tous les utilisateurs</p>
                        <span class="badge badge-kpi" th:text="${nbUtilisateurs}">0</span>
                    </div>
                </div>
            </a>
        </div>

        <!-- Capteurs -->
        <div class="col-12 col-md-6 col-lg-4">
            <a href="/capteurs" class="text-decoration-none">
                <div class="card kpi-card card-gradient-success shadow-sm position-relative">
                    <div class="card-body">
                        <i class="bi bi-satellite kpi-icon mb-2"></i>
                        <h5>Capteurs</h5>
                        <p class="kpi-description">Suivre l’état des capteurs</p>
                        <span class="badge badge-kpi" th:text="${nbCapteurs}">0</span>
                    </div>
                </div>
            </a>
        </div>

        <!-- Produits -->
        <div class="col-12 col-md-6 col-lg-4">
            <a href="/produits" class="text-decoration-none">
                <div class="card kpi-card card-gradient-warning shadow-sm position-relative">
                    <div class="card-body">
                        <i class="bi bi-box-seam kpi-icon mb-2"></i>
                        <h5>Produits</h5>
                        <p class="kpi-description">Gérer les produits disponibles</p>
                        <span class="badge badge-kpi" th:text="${nbProduits}">0</span>
                    </div>
                </div>
            </a>
        </div>

        <!-- Commandes -->
        <div class="col-12 col-md-6 col-lg-4">
            <a href="/commandes" class="text-decoration-none">
                <div class="card kpi-card card-gradient-danger shadow-sm position-relative">
                    <div class="card-body">
                        <i class="bi bi-cart kpi-icon mb-2"></i>
                        <h5>Commandes</h5>
                        <p class="kpi-description">Suivre les commandes en cours</p>
                        <span class="badge badge-kpi" th:text="${nbCommandes}">0</span>
                    </div>
                </div>
            </a>
        </div>

        <!-- Alertes -->
        <div class="col-12 col-md-6 col-lg-4">
            <a href="/alertes" class="text-decoration-none">
                <div class="card kpi-card card-gradient-secondary shadow-sm position-relative">
                    <div class="card-body">
                        <i class="bi bi-exclamation-triangle kpi-icon mb-2"></i>
                        <h5>Alertes</h5>
                        <p class="kpi-description">Consulter les alertes importantes</p>
                        <span class="badge badge-kpi" th:text="${nbAlertes}">0</span>
                    </div>
                </div>
            </a>
        </div>

        <!-- Ventes -->
        <div class="col-12 col-md-6 col-lg-4">
            <a href="/agriculteur/ventes" class="text-decoration-none">
                <div class="card kpi-card card-gradient-success shadow-sm position-relative">
                    <div class="card-body">
                        <i class="bi bi-cart3 kpi-icon mb-2"></i>
                        <h5>Ventes</h5>
                        <p class="kpi-description">Voir et gérer toutes les ventes</p>
                        <span class="badge badge-kpi" th:text="${nbVentes}">0</span>
                    </div>
                </div>
            </a>
        </div>

        <!-- Météo -->
        <div class="col-12 col-md-6 col-lg-4">
            <a href="/meteo" class="text-decoration-none">
                <div class="card kpi-card card-gradient-weather shadow-sm position-relative">
                    <div class="card-body">
                        <i class="bi bi-cloud-sun kpi-icon mb-2"></i>
                        <h5>Météo</h5>
                        <p class="kpi-description">Voir la météo complète</p>
                        <span class="badge badge-kpi" id="dashboardTemp">--°C</span>
                    </div>
                </div>
            </a>
        </div>

    </div>

    <!-- Footer -->
    <footer class="mt-5">
        <p class="mb-0">© 2025 - Plateforme Agricole - Dashboard Admin</p>
    </footer>
</div>

<script>
    const sidebar = document.getElementById("sidebar");
    const content = document.getElementById("content");
    const menuToggle = document.getElementById("menuToggle");

    menuToggle.addEventListener("click", () => {
        if (window.innerWidth > 768) {
            sidebar.classList.toggle("collapsed");
            content.classList.toggle("collapsed");
        } else {
            sidebar.classList.toggle("active");
        }
    });

    // 🌤️ Météo dashboard
    const dashboardTemp = document.getElementById("dashboardTemp");
    const city = "Matam";
    const apiKey = "91a421e86c57cd1309cb65e78e8d673a";

    async function updateDashboardWeather() {
        try {
            const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=fr`);
            const data = await res.json();
            dashboardTemp.innerText = Math.round(data.main.temp) + "°C";
        } catch (err) {
            console.error("Erreur météo dashboard:", err);
            dashboardTemp.innerText = "--°C";
        }
    }

    updateDashboardWeather();
    setInterval(updateDashboardWeather, 600000);
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Météo - Matam</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; }
        .weather-card { border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.15); padding: 20px; text-align:center; margin-bottom:20px; }
        .forecast-card { border-radius:12px; background:#fff; padding:10px; text-align:center; margin-bottom:15px; box-shadow:0 5px 15px rgba(0,0,0,0.1); }
        iframe { width: 100%; height: 400px; border-radius:12px; border:none; }
    </style>
</head>
<body>
<div class="container py-4">
    <h1 class="text-center mb-4">🌦️ Météo à Matam</h1>

    <!-- Météo actuelle -->
    <div class="weather-card bg-warning text-white">
        <h2 id="city">Chargement...</h2>
        <h1 id="temp">--°C</h1>
        <i id="icon" class="bi bi-cloud-sun fs-1"></i>
        <p id="description">Chargement...</p>
    </div>

    <!-- Prévisions 5 jours -->
    <h3 class="mb-3">📅 Prévisions 5 jours</h3>
    <div class="row" id="forecast"></div>

    <!-- Carte radar -->
    <h3 class="mt-5 mb-3">🛰️ Carte Radar</h3>
    <iframe src="https://www.meteoetradar.com/meteo/matam/17540871" allowfullscreen></iframe>
</div>

<script>
    const apiKey = "91a421e86c57cd1309cb65e78e8d673a";
    const city = "Matam";

    async function getCurrentWeather() {
        try {
            const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=fr`);
            const data = await res.json();

            document.getElementById("city").textContent = data.name;
            document.getElementById("temp").textContent = Math.round(data.main.temp) + "°C";
            document.getElementById("description").textContent = data.weather[0].description;

            let iconClass = "bi-cloud";
            const main = data.weather[0].main;
            if(main.includes("Rain")) iconClass="bi-cloud-rain-fill";
            if(main.includes("Clear")) iconClass="bi-sun-fill";
            if(main.includes("Cloud")) iconClass="bi-cloud-fill";
            if(main.includes("Snow")) iconClass="bi-snow";
            document.getElementById("icon").className = "bi "+iconClass+" fs-1";
        } catch(err) {
            console.error("Erreur météo:", err);
            document.getElementById("temp").textContent="--°C";
            document.getElementById("description").textContent="Erreur chargement";
        }
    }

    async function getForecast() {
        try {
            const res = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric&lang=fr`);
            const data = await res.json();
            const forecastContainer = document.getElementById("forecast");
            forecastContainer.innerHTML = "";

            for(let i=0;i<data.list.length;i+=8) {
                const f = data.list[i];
                const date = new Date(f.dt_txt).toLocaleDateString("fr-FR", { weekday: "long" });
                const temp = Math.round(f.main.temp)+"°C";
                const desc = f.weather[0].description;

                forecastContainer.innerHTML += `
                    <div class="col-6 col-md-2 mb-3">
                        <div class="forecast-card">
                            <h6>${date}</h6>
                            <p><strong>${temp}</strong></p>
                            <small>${desc}</small>
                        </div>
                    </div>`;
            }
        } catch(err) {
            console.error("Erreur prévisions:", err);
        }
    }

    getCurrentWeather();
    getForecast();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
